knitr::opts_chunk$set(echo = TRUE, comment = NA)
library(gridExtra)
knitr::opts_chunk$set(echo = TRUE, comment = NA)
library(readr)
library(dplyr)
library(ggplot2)
library(choroplethr)
library(choroplethrMaps)
library(choroplethrZip)
library(GGally)
library(lubridate)
library(zoo)
library(scales)
library(ggmap)
library(scales)
library(stringr)
library(zipcode)
library(leaflet)
library(extracat)
library(gridExtra)
source("https://raw.githubusercontent.com/iascchen/VisHealth/master/R/calendarHeat.R")
options(scipen=999)
#http://insideairbnb.com/get-the-data.html
listings <- read_csv("listings.csv")
reviews <- read_csv("reviews.csv")
calendar <- read_csv("calendar.csv")
neighborhood <- read_csv("neighbourhoods.csv")
# Which locations have better ratings?
zipReviews <- listings %>% group_by(zipcode = zipcode) %>% summarise(avg_loc_review = mean(review_scores_location, na.rm = TRUE))
colnames(zipReviews) <- c("region","value")
zipReviews$region <- as.character(zipReviews$region)
nyc_fips = c(36005, 36047, 36061, 36081, 36085)
g_locations <- zip_choropleth(zipReviews,
county_zoom = nyc_fips,
title = "Location Review Scores by Region",
legend = "Average Score") + ggtitle("Which area is the best?",
subtitle = "Map showing Average Location Score by Area") +
theme(plot.title = element_text(face = "bold")) +
theme(plot.subtitle = element_text(face = "bold", color = "grey35")) +
theme(plot.caption = element_text(color = "grey68"))+scale_color_gradient(low="#d3cbcb", high="#852eaa")+ scale_fill_brewer("Location Review Score",palette=3)
g_locations
#Which area is more expensive?
listings$price <- as.numeric(gsub(",", "", substring(listings$price, 2)))
zipPrices <- listings %>% group_by(zipcode = zipcode) %>% summarise(avg_price = mean(price, na.rm = TRUE))
colnames(zipPrices) <- c("region","value")
zipPrices$region <- as.character(zipPrices$region)
nyc_fips = c(36005, 36047, 36061, 36081, 36085)
g_price_location <- zip_choropleth(zipPrices,
county_zoom = nyc_fips,
title = "Average Price by Region",
legend = "Average Score") + ggtitle("Which area is expensive?",
subtitle = "Map showing Average Price by Area") +
theme(plot.title = element_text(face = "bold")) +
theme(plot.subtitle = element_text(face = "bold", color = "grey35")) +
theme(plot.caption = element_text(color = "grey68"))+scale_color_gradient(low="#d3cbcb", high="#852eaa")+ scale_fill_brewer("Average Price",palette=4)
g_price_location
grid.arrange(g_locations, g_price_location, col=2 )
grid.arrange(g_locations, g_price_location, ncol=2)
grid.arrange(g_locations, g_price_location, ncol=2)
listings1 <- listings
num_reviews <- reviews %>% group_by(listing_id)%>% summarise(sum1 = n())
listings1$host_response_rate = as.integer(gsub("%","",listings1$host_response_rate))
listings1$review_scores_rating = as.integer(gsub("%","",listings1$review_scores_rating))
#list1 = listings[!is.na(listings$host_response_rate) & is.na(listings$review_scores_rating),]
l1 = listings1[!is.na(listings1$review_scores_rating),]
l1 = l1[!is.na(l1$host_is_superhost),]
l1 = l1[l1$host_is_superhost!='',]
l1$host_is_superhost[l1$host_is_superhost == "t"] <- "True"
l1$host_is_superhost[l1$host_is_superhost == "f"] <- "False"
l1$host_is_superhost <- factor(l1$host_is_superhost)
colnames(num_reviews) = c("id","sum")
l1 = merge(l1, num_reviews, by = "id")
colnames(l1)[which(names(l1) == "host_is_superhost")] <- "Superhost"
g = ggplot(l1,aes(host_response_rate,review_scores_rating,color=Superhost))+geom_point(alpha = .5,stroke=0) +xlab("Host Response Rate") +ylab("Avg Ratings")+ ggtitle("What does it take to be a Super Host")
g + ggtitle("What does it take to be a Superhost?",
subtitle = "Average Rating by Response Rate") +
theme(plot.title = element_text(face = "bold")) +
theme(plot.subtitle = element_text(face = "bold", color = "grey35")) +
theme(plot.caption = element_text(color = "grey68"))
listings1 <- listings
num_reviews <- reviews %>% group_by(listing_id)%>% summarise(sum1 = n())
listings1$host_response_rate = as.integer(gsub("%","",listings1$host_response_rate))
listings1$review_scores_rating = as.integer(gsub("%","",listings1$review_scores_rating))
#list1 = listings[!is.na(listings$host_response_rate) & is.na(listings$review_scores_rating),]
l1 = listings1[!is.na(listings1$review_scores_rating),]
l1 = l1[!is.na(l1$host_is_superhost),]
l1 = l1[l1$host_is_superhost!='',]
l1$host_is_superhost[l1$host_is_superhost == "t"] <- "True"
l1$host_is_superhost[l1$host_is_superhost == "f"] <- "False"
l1$host_is_superhost <- factor(l1$host_is_superhost)
colnames(num_reviews) = c("id","sum")
l1 = merge(l1, num_reviews, by = "id")
colnames(l1)[which(names(l1) == "host_is_superhost")] <- "Superhost"
superhost = ggplot(l1,aes(host_response_rate,review_scores_rating,color=Superhost))+geom_point(alpha = .5,stroke=0) +xlab("Host Response Rate") +ylab("Avg Ratings")+ ggtitle("What does it take to be a Super Host")
superhost + ggtitle("What does it take to be a Superhost?",
subtitle = "Average Rating by Response Rate") +
theme(plot.title = element_text(face = "bold")) +
theme(plot.subtitle = element_text(face = "bold", color = "grey35")) +
theme(plot.caption = element_text(color = "grey68"))
listings1 <- listings
num_reviews <- reviews %>% group_by(listing_id)%>% summarise(sum1 = n())
listings1$host_response_rate = as.integer(gsub("%","",listings1$host_response_rate))
listings1$review_scores_rating = as.integer(gsub("%","",listings1$review_scores_rating))
#list1 = listings[!is.na(listings$host_response_rate) & is.na(listings$review_scores_rating),]
l1 = listings1[!is.na(listings1$review_scores_rating),]
l1 = l1[!is.na(l1$host_is_superhost),]
l1 = l1[l1$host_is_superhost!='',]
l1$host_is_superhost[l1$host_is_superhost == "t"] <- "True"
l1$host_is_superhost[l1$host_is_superhost == "f"] <- "False"
l1$host_is_superhost <- factor(l1$host_is_superhost)
colnames(num_reviews) = c("id","sum")
l1 = merge(l1, num_reviews, by = "id")
colnames(l1)[which(names(l1) == "host_is_superhost")] <- "Superhost"
superhost = ggplot(l1,aes(host_response_rate,review_scores_rating,color=Superhost))+geom_point(alpha = .5,stroke=0) +xlab("Host Response Rate") +ylab("Avg Ratings")+ ggtitle("What does it take to be a Super Host")
superhost + ggtitle("What does it take to be a Superhost?",
subtitle = "Average Rating by Response Rate") +
theme(plot.title = element_text(face = "bold")) +
theme(plot.subtitle = element_text(face = "bold", color = "grey35")) +
theme(plot.caption = element_text(color = "grey68"))
superhost + ggtitle("What does it take to be a Superhost?",
subtitle = "Average Rating by Response Rate") +
theme(plot.title = element_text(face = "bold")) +
theme(plot.subtitle = element_text(face = "bold", color = "grey35")) +
theme(plot.caption = element_text(color = "grey68"))
ggplot(reviewsNum[year(reviewsNum$date) == 2016,], aes(date, number)) +
geom_point(na.rm=TRUE, color = "#007A87", alpha=0.5) +geom_smooth(color = "#FF5A5F")+
ggtitle("Seasonality in Demand",
subtitle = "Number of Reviews across Months in 2016") +
labs(x = "Month", y = "Unique listings recieving reviews") +
theme(plot.title = element_text(face = "bold")) +
theme(plot.subtitle = element_text(face = "bold", color = "grey35")) +
theme(plot.caption = element_text(color = "grey68"))
reviewsNum <- reviews %>% group_by(date = reviews$date) %>% summarise(number = n())
ggplot(reviewsNum, aes(date, number)) +
geom_point(na.rm=TRUE, color = "#007A87", alpha=0.5) +geom_smooth(color = "#FF5A5F")+
ggtitle("How popular is Airbnb?",
subtitle = "Number of Reviews across years") +
labs(x = "Year", y = "Unique listings recieving reviews") +
theme(plot.title = element_text(face = "bold")) +
theme(plot.subtitle = element_text(face = "bold", color = "grey35")) +
theme(plot.caption = element_text(color = "grey68"))
ggplot(reviewsNum[year(reviewsNum$date) == 2016,], aes(date, number)) +
geom_point(na.rm=TRUE, color = "#007A87", alpha=0.5) +geom_smooth(color = "#FF5A5F")+
ggtitle("Seasonality in Demand",
subtitle = "Number of Reviews across Months in 2016") +
labs(x = "Month", y = "Unique listings recieving reviews") +
theme(plot.title = element_text(face = "bold")) +
theme(plot.subtitle = element_text(face = "bold", color = "grey35")) +
theme(plot.caption = element_text(color = "grey68"))
ggplot(reviewsNum[year(reviewsNum$date) == 2017,], aes(date, number)) +
geom_point(na.rm=TRUE, color = "#007A87", alpha=0.5) +geom_smooth(color = "#FF5A5F")+
ggtitle("Seasonality in Demand",
subtitle = "Number of Reviews across Months in 2017") +
labs(x = "Month", y = "Unique listings recieving reviews") +
theme(plot.title = element_text(face = "bold")) +
theme(plot.subtitle = element_text(face = "bold", color = "grey35")) +
theme(plot.caption = element_text(color = "grey68"))
demand2018 <- ggplot(reviewsNum[year(reviewsNum$date) == 2018,], aes(date, number)) +
geom_point(na.rm=TRUE, color = "#007A87", alpha=0.5) +geom_smooth(color = "#FF5A5F")+
ggtitle("Seasonality in Demand",
subtitle = "Number of Reviews across Months in 2018") +
labs(x = "Month", y = "Unique listings recieving reviews") +
theme(plot.title = element_text(face = "bold")) +
theme(plot.subtitle = element_text(face = "bold", color = "grey35")) +
theme(plot.caption = element_text(color = "grey68"))
ggplot(reviewsNum[year(reviewsNum$date) == 2016,], aes(date, number)) +
geom_point(na.rm=TRUE, color = "#007A87", alpha=0.5) +geom_smooth(color = "#FF5A5F")+
ggtitle("Seasonality in Demand",
subtitle = "Number of Reviews across Months in 2016") +
labs(x = "Month", y = "Unique listings recieving reviews") +
theme(plot.title = element_text(face = "bold")) +
theme(plot.subtitle = element_text(face = "bold", color = "grey35")) +
theme(plot.caption = element_text(color = "grey68"))
ggplot(reviewsNum[year(reviewsNum$date) == 2017,], aes(date, number)) +
geom_point(na.rm=TRUE, color = "#007A87", alpha=0.5) +geom_smooth(color = "#FF5A5F")+
ggtitle("Seasonality in Demand",
subtitle = "Number of Reviews across Months in 2017") +
labs(x = "Month", y = "Unique listings recieving reviews") +
theme(plot.title = element_text(face = "bold")) +
theme(plot.subtitle = element_text(face = "bold", color = "grey35")) +
theme(plot.caption = element_text(color = "grey68"))
demand2018 <- ggplot(reviewsNum[year(reviewsNum$date) == 2018,], aes(date, number)) +
geom_point(na.rm=TRUE, color = "#007A87", alpha=0.5) +geom_smooth(color = "#FF5A5F")+
ggtitle("Seasonality in Demand",
subtitle = "Number of Reviews across Months in 2018") +
labs(x = "Month", y = "Unique listings recieving reviews") +
theme(plot.title = element_text(face = "bold")) +
theme(plot.subtitle = element_text(face = "bold", color = "grey35")) +
theme(plot.caption = element_text(color = "grey68"))
demand2018
calendar2016 <- read_csv("calendar2016.csv")
calendar2017 <- read_csv("calendar2017.csv")
calendar2018 <- read_csv("calendar.csv")
combinedCalendar <- rbind(calendar2016, calendar2017, calendar2018)
combinedCalendar$price <- as.numeric(gsub(",", "", substring(combinedCalendar$price, 2)))
groupedCalendarAll <- combinedCalendar %>% group_by(date = date) %>% summarise(averagePrice = mean(price, na.rm = TRUE)) %>% mutate(year = year(date), commonYear = paste("2016",substring(date, 6),sep="-"))
groupedCalendarAll$year <- as.factor(as.character(groupedCalendarAll$year))
groupedCalendarAll$commonYear <- ymd(groupedCalendarAll$commonYear)
ggplot(groupedCalendarAll[year(groupedCalendarAll$date) >= 2017 & year(groupedCalendarAll$date) < 2019,], aes(commonYear, averagePrice)) +
geom_point(na.rm=TRUE, alpha=0.5, color = "#007A87") + geom_smooth(color = "#FF5A5F")+ facet_grid(~year)+
ggtitle("Seasonality in Price",
subtitle = "Average listing price across Months") +
labs(x = "Month", y = "Average price across Listings") +
theme(plot.title = element_text(face = "bold")) +
theme(plot.subtitle = element_text(face = "bold", color = "grey35")) +
theme(plot.caption = element_text(color = "grey68")) + scale_x_date(labels = date_format("%b"))
ggplot(groupedCalendarAll[year(groupedCalendarAll$date) == 2018,], aes(commonYear, averagePrice)) +
geom_point(na.rm=TRUE, alpha=0.5, color = "#007A87") + geom_smooth(color = "#FF5A5F")+ facet_grid(~year)+
ggtitle("Seasonality in Price",
subtitle = "Average listing price across Months") +
labs(x = "Month", y = "Average price across Listings") +
theme(plot.title = element_text(face = "bold")) +
theme(plot.subtitle = element_text(face = "bold", color = "grey35")) +
theme(plot.caption = element_text(color = "grey68")) + scale_x_date(labels = date_format("%b"))
price2018 <- ggplot(groupedCalendarAll[year(groupedCalendarAll$date) == 2018,], aes(commonYear, averagePrice)) +
geom_point(na.rm=TRUE, alpha=0.5, color = "#007A87") + geom_smooth(color = "#FF5A5F")+
ggtitle("Seasonality in Price",
subtitle = "Average listing price in 2018") +
labs(x = "Month", y = "Average price across Listings") +
theme(plot.title = element_text(face = "bold")) +
theme(plot.subtitle = element_text(face = "bold", color = "grey35")) +
theme(plot.caption = element_text(color = "grey68")) + scale_x_date(labels = date_format("%b"))
price2018 <- ggplot(groupedCalendarAll[year(groupedCalendarAll$date) == 2018,], aes(commonYear, averagePrice)) +
geom_point(na.rm=TRUE, alpha=0.5, color = "#007A87") + geom_smooth(color = "#FF5A5F")+
ggtitle("Seasonality in Price",
subtitle = "Average listing price in 2018") +
labs(x = "Month", y = "Average price across Listings") +
theme(plot.title = element_text(face = "bold")) +
theme(plot.subtitle = element_text(face = "bold", color = "grey35")) +
theme(plot.caption = element_text(color = "grey68")) + scale_x_date(labels = date_format("%b"))
price2018 <- ggplot(groupedCalendarAll[year(groupedCalendarAll$date) == 2018,], aes(commonYear, averagePrice)) +
geom_point(na.rm=TRUE, alpha=0.5, color = "#007A87") + geom_smooth(color = "#FF5A5F")+
ggtitle("Seasonality in Price",
subtitle = "Average listing price across Months in 2018") +
labs(x = "Month", y = "Average price across Listings") +
theme(plot.title = element_text(face = "bold")) +
theme(plot.subtitle = element_text(face = "bold", color = "grey35")) +
theme(plot.caption = element_text(color = "grey68")) + scale_x_date(labels = date_format("%b"))
price2018
grid.arrange(demand2018, price2018, ncol=2)
grid.arrange(demand2018, price2018, ncol=2)
